# ecotrop

Описание нашего алгоритма для тех. питча.

2.0. Путник может задать точки А и В только на путевом графе, это во всех картах так. У нас он может также задать уровень  уровне зелености маршрута.
2.1. Исключаем из путевого графа красные ребра - получаем жёлто-зеленый граф и такие же маршруты.
Исключаем незелёные ребра - получаем зеленый граф/ маршруты. При динамической оценки работаем с прогнозными функциями чистоты, при стационарной - со стационарными.
2.2. Компонента связности исходной точки А -  библиотечная функция (её значение - граф, аргумент - точка).  При выбранном  уровне зелености маршрута (а значит, и путевого графа) путник выбирает В только в этой компоненте связности.  Другая его возможность - выбрать наиболее зеленый КОЛЬЦЕВОЙ маршрут из А в А НЕ КОРОЧЕ или НЕ ДЛИННЕЕ заданного расстояния (при указании им средней скорости пути или подстановки среднего значения для указанного путником способа, пеший или вело - - заданного времени).  Для того, чтоб откуда-то добраться из А или выбраться из В, пусть отказывается от зелености и возвращается к стандартному функционалу "Мостранспорта", и там можно снова выбрать экомаршрут - уже с пониженной зеленостью, например желто-зеленый. В нашем проекте мы с расписанием общ. транспорта не связываемся - отсылаем к стандарту, все зеленое у нас без авто (если не заставят электроавтомобили включить: в кейсе нет, можно спросить трекера о планах). Было бы желательно позволить выбирать А и В из велопрокатов  Москвы и предлагать электросамокатным прокатным фирмам услугу подключения их данных. 
2.3. Чтобы была оптимизация маршрута, дискретизация зелености должна включать больше одного уровню. Сколько будет (желто-)зеленых из 9 изокаф, зависит от исходной настройки, определяемой заказчиком, зеленых уровней на 1 больше. 
Рекомендация заказчику: если задать достаточно много зеленых из 10 уровней, ВСЕ зеленые точки войдут в ОДНУ компоненту связности (красными будут обходимые "дырки").
2.4. С исходными данными закончили, вот алгоритм построения оптимального маршрута.
Если (для определенности) оценка зелености А меньше, чем В, то путнику гарантирован маршрут зеленее, чем А.
Итеративное построение. В конце каждой итерации построенный фрагмент присоединяется к одному из двух  сохраненных фрагментов маршрута, до начала итераций они состоят из А и В (а множества ребер пусты) пусты Путь к следующему уровню зелености из А выбирается кратчайшим (по типу градиентного метода) и присоединяется к сохраненному. Пересечение с изокафой при нашем определении ребер возможно только в вершине. Она объявляется А1, и новая итерация для пути А1-В.
Если ОБЕ А и В имеют РАВНУЮ оценку зелености, строится прямоугольник с диагональю АВ и сторонами, параллельными осям (можно по выбору путника "ПРОГУЛОЧНЫЙ" ИЛИ ЗАКАЗЧИКА предлагать круг с диаметром АВ, маршруты станут длиннее в наиболее зеленой зоне). Если он пересекается с лучшей изокафой, то не менее чем в 2 точках. Выбираются ближайшая к А А1 и к В В1, новая итерация. Если не пересекается  (в т.ч. вырожденный случай - А и В совпадают), все пути из А в В достраивают сохраненные два фрагмента маршрута до оптимального.  Выдать можно N кратчайших или в прогулочном маршруте длиннейших без самопересечений.
2.5. Оптимальный кольцевой маршрут из А в А строится зданием наиболее зеленой точки В на середине заданного пути (времени). Первое приближение для поиска такой точки дает окружность с центром в А и диаметром АВ/ 1,4
![image](https://user-images.githubusercontent.com/58040903/134795644-841f7694-22b1-4b05-bb1b-44ee5c782299.png)
